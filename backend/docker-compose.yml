
services:
  api-gateway:
    build: ./api-gateway
    container_name: api-gateway
    ports:
      - "3000:3000"
    environment:
      PORT: 3000
      AGENT_SERVICE: http://agent-service:4001
      CONVERSATION_SERVICE: http://conversation-service:4002
      AI_SERVICE_URL: http://ai-service:4000
    depends_on:
      - agent-service
      - conversation-service
      - ai-service
    networks:
      - backend

  agent-service:
    build: ./agent-service
    container_name: agent-service
    environment:
      PORT: 4001
      MONGO_URI: ${AGENT_DB}   # MongoDB Compass URI from .env
    ports:
      - "4001:4001"
    networks:
      - backend

  conversation-service:
    build: ./conversation-service
    container_name: conversation-service
    environment:
      PORT: 4002
      MONGO_URI: ${CONVERSATION_DB}  # MongoDB Compass URI from .env
      AI_SERVICE_URL: http://ai-service:4000
      AGENT_SERVICE: http://agent-service:4001
    ports:
      - "4002:4002"
    networks:
      - backend

  ai-service:
    build: ./ai-service
    container_name: ai-service
    environment:
      PORT: 4000
      OPENAI_API_KEY: ${OPENAI_API_KEY}
      GEMINI_API_KEY: ${GEMINI_API_KEY}
      PERPLEXITY_API_KEY: ${PERPLEXITY_API_KEY}
    ports:
      - "4000:4000"
    networks:
      - backend
  user-service:
    build: ./user-service
    container_name: user-service
    environment:
      PORT: 4003
      MONGO_URI: ${USER_DB}
      JWT_SECRET: ${JWT_SECRET}
    ports:
      - "4003:4003"
    networks:
    - backend

    

networks:
  backend:
    driver: bridge
